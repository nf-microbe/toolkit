/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for defining DSL2 per module options and publishing paths
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Available keys to override module options:
        ext.args   = Additional arguments appended to command in module.
        ext.args2  = Second set of arguments appended to command in module (multi-tool modules).
        ext.args3  = Third set of arguments appended to command in module (multi-tool modules).
        ext.prefix = File name prefix for output files.
----------------------------------------------------------------------------------------
*/

process {

    withName: '.*' {
        ext.prefix = { prefix ->
            if (meta.chunk && meta.extension) { "${meta.id}_run${meta.run}_${meta.assembler}_${meta.extension}_${meta.chunk}" }
            else if (meta.chunk && meta.assembler) { "${meta.id}_run${meta.run}_${meta.assembler}_${meta.chunk}" }
            else if (meta.chunk) { "${meta.id}_run${meta.run}_${meta.chunk}" }
            else if (meta.assembler) { "${meta.id}_run${meta.run}_${meta.assembler}" }
            else if (meta.run) { "${meta.id}_run${meta.run}" }
            else { "${meta.id}" }
        }
        publishDir = { "${params.outdir}" + "/" + task.process.replace(':', '/').toLowerCase() }
    }

    withName: BOWTIE2_ALIGN {
        ext.args = params.bowtie2_host_removal_args ? params.bowtie2_host_removal_args : ""
    }

    withName: COBRAMETA {
        ext.args = params.cobra_args ? params.cobra_args : ""
    }

    withName: COVERM_CONTIG_COBRA {
        ext.args = params.cobra_coverm_args ? params.cobra_coverm_args : ""
    }

    withName: FASTP {
        ext.args = params.fastp_args ? params.fastp_args : ""
    }

    withName: LOGAN_CONTIGAWSCLIMULTIPLIER {
        ext.args = [
            params.logan_contigs_min_abund ? "--abundance ${params.logan_contigs_min_abund}" : "",
            params.logan_contigs_multiplier ? "--multiplier" : "",
        ].join(' ').trim()
    }

    withName: LOGAN_UNITIGAWSCLIMULTIPLIER {
        ext.args = [
            params.logan_unitigs_min_abund ? "--abundance ${params.logan_unitigs_min_abund}" : "",
            params.logan_unitigs_multiplier ? "--multiplier" : "",
        ].join(' ').trim()
    }

    withName: 'MEGAHIT.*' {
        ext.args = params.megahit_args ? params.megahit_args : ""
    }

    withName: 'PLASS_PENGUIN.*' {
        ext.args = params.penguin_args ? params.penguin_args : ""
    }

    withName: SEQKIT_FX2TAB_COBRA {
        ext.args = "--header-line --name"
        ext.suffix = "txt"
    }

    withName: SEQKIT_SEQ {
        ext.args = "--min-len ${params.assembly_min_len}"
    }

    withName: SEQKIT_SEQ_COBRA {
        ext.args = "--min-len ${params.cobra_min_len}"
    }

    withName: 'SPADES.*' {
        ext.args = params.spades_args ? params.spades_args : ""
    }

    withName: SRA_SRATOOLS {
        ext.args = params.sratools_args ? params.sratools_args : ""
    }

    withName: VIROMEQC_VIROMEQC {
        ext.args = params.viromeqc_args ? params.viromeqc_args : ""
    }

}
